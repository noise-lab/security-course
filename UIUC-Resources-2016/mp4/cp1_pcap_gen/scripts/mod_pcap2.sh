#!/bin/bash
# check arguments
if [ "$#" -ne 3 ]; then
  echo "usage: sudo ./mod_pcap2.sh {message} {original_pcap} {output_dir} in absolute paths"
  exit 1
fi

ORIG_MSG1="2544302539452544312538312544312538322544302542302544302542442544302542452544302542322544302542382544312538322544312538432532302544302542442544312538452544312538352544302542302544312538452544312538322532304d792532305769466921"
NEW_MSG1="$1"
ORIG_MSG2="5c75303431655c75303434315c75303434325c75303433305c75303433645c75303433655c75303433325c75303433385c75303434325c7530343463205c75303433645c75303434655c75303434355c75303433305c75303434655c7530343432204d79205769466921"
ORIG_MSG2="1f8b08000000000000036c50c16a843014fc15fb4e2dc8929898aeee692f853df456e8a12d1263dc4dab89c46c1759f6dffba22d5e1a64903733c9cc6b9d4fee77bb87dd15aa4a7a28690a839c3a271b28afd0eb7194471d7fc773fda95580d29ebb2e85da351394f07e269cea889cce98456464c666c69965cb7cbb6ab84a56115faec857f3ef244b9ea7e4d53c993b482118cc13643f604cc60bf1481979ccb948a13718174cb3a199a0421439a7c59631369bfe28c1b69c899cf00cbf02a951db46fbaaada384123c1881922ccb054fc1b56d67acaec2c96bd9187baca26c69bf38f149d919a537487ebbce61b6589970d24aa56be7be36caf5eb4356f6b84ad8474f72583d31a53c8e488deeec952e8309d296175d47ef3cfa9f93214875eab50d8706ed6f1f29b4ce5fa4c7a02405af876edaab609c7d9906bc0367ca398f6564d06858cac85931b78375afa2880bc103b7144ea1ef9085dbed070000ffff"
NEW_MSG2=$(printf '%-706s' "0")
NEW_MSG2=$(echo "${NEW_MSG2// /0}")
OUTPUT="$3/4.1.2.pcap"

hexdump -ve '1/1 "%.2x"' "$2" | sed "s/${ORIG_MSG1}/${NEW_MSG1}/g; s/${ORIG_MSG2}/${NEW_MSG2}/g" | xxd -r -p > "${OUTPUT}"
